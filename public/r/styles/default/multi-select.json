{
  "$schema": "https://ui.fingertip.com/schema/registry-item.json",
  "name": "multi-select",
  "author": "fingertip (https://ui.fingertip.com)",
  "dependencies": [
    "@fingertip/icons",
    "@radix-ui/react-popover"
  ],
  "registryDependencies": [
    "badge",
    "button",
    "checkbox",
    "command",
    "label"
  ],
  "files": [
    {
      "path": "ui/multi-select.tsx",
      "content": "\"use client\";\nimport { PlusLargeIcon, TagIcon } from \"@fingertip/icons\";\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\";\nimport { KeyboardEvent, ReactNode, useRef, useState } from \"react\";\n\nimport { Badge } from \"./badge\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandSeparator,\n} from \"./command\";\nimport { cn } from \"@/lib/utils\";\n\nimport { Button } from \"./button\";\nimport { Checkbox } from \"./checkbox\";\nimport { Label } from \"./label\";\n\ninterface Option {\n  value: string;\n  label: string;\n}\n\ninterface MultiSelectProps {\n  options: Option[];\n  selected: string[];\n  partiallySelected?: string[]; // New prop for intermediate state\n  onChange: (tagId: string, remove: boolean) => void;\n  onCreateOption?: (value: string) => void;\n  placeholder?: string;\n  className?: string;\n  disabled?: boolean;\n  label?: ReactNode;\n}\n\nexport function MultiSelect({\n  options,\n  selected,\n  partiallySelected = [], // Default to empty array\n  onChange,\n  onCreateOption,\n  className,\n  disabled = false,\n  placeholder = \"Add tags...\",\n  label = \"Custom tags\",\n}: MultiSelectProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [inputValue, setInputValue] = useState(\"\");\n  const containerRef = useRef<HTMLDivElement>(null);\n  const listboxRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const handleInputKeyDown = (e: KeyboardEvent) => {\n    // Create new label on Enter if text exists and creation is allowed\n    if (e.key === \"Enter\" && inputValue && onCreateOption) {\n      onCreateOption(inputValue);\n      setInputValue(\"\");\n      e.preventDefault();\n    }\n  };\n\n  const filteredOptions = options.filter((option) =>\n    option.label.toLowerCase().includes(inputValue.toLowerCase()),\n  );\n\n  const hasExactMatch = filteredOptions.some(\n    (option) => option.label.toLowerCase() === inputValue.toLowerCase(),\n  );\n\n  return (\n    <PopoverPrimitive.Root open={isOpen} onOpenChange={setIsOpen}>\n      <div\n        className={cn(\"mb-4 relative text-left w-full\", className)}\n        ref={containerRef}\n      >\n        <PopoverPrimitive.Trigger asChild disabled={disabled}>\n          <div>\n            <div className=\"mb-2\">\n              <Label>{label}</Label>\n            </div>\n\n            <div\n              className={cn(\n                \"flex min-h-[52px] w-full items-center rounded-2xl border border-input bg-card px-3 py-2 cursor-pointer shadow-input hover:border-input-hover focus-within:border-ring focus-within:outline-hidden\",\n                disabled && \"opacity-50 cursor-not-allowed\",\n              )}\n            >\n              <div className=\"flex flex-wrap gap-1.5\">\n                {selected.length > 0 || partiallySelected.length > 0 ? (\n                  <>\n                    {/* Fully selected tags */}\n                    {selected.map((value) => {\n                      const option = options.find((opt) => opt.value === value);\n                      return option ? (\n                        <Badge key={value} variant=\"default\">\n                          {option.label}\n                        </Badge>\n                      ) : null;\n                    })}\n\n                    {/* Partially selected tags */}\n                    {partiallySelected.map((value) => {\n                      const option = options.find((opt) => opt.value === value);\n                      return option ? (\n                        <Badge\n                          key={value}\n                          variant=\"default\"\n                          className=\"opacity-50\"\n                        >\n                          {option.label}\n                        </Badge>\n                      ) : null;\n                    })}\n\n                    <span className=\"h-6 flex items-center text-muted-foreground cursor-pointer\">\n                      <PlusLargeIcon className=\"size-4\" />\n                    </span>\n                  </>\n                ) : (\n                  <span className=\"flex items-center text-sm text-muted-foreground\">\n                    <TagIcon className=\"size-4 mr-2\" />\n                    Add tag\n                  </span>\n                )}\n              </div>\n            </div>\n          </div>\n        </PopoverPrimitive.Trigger>\n\n        <PopoverPrimitive.Anchor />\n\n        <PopoverPrimitive.Portal>\n          <PopoverPrimitive.Content\n            align=\"start\"\n            side=\"bottom\"\n            className=\"popover-content relative z-110 max-h-[250px] min-w-32 translate-y-1 overflow-hidden rounded-xl border border-border bg-popover text-popover-foreground shadow-soft animate-in fade-in-80\"\n            asChild\n            onOpenAutoFocus={(event) => event.preventDefault()}\n            onInteractOutside={(event) => {\n              const target = event.target as Element | null;\n              const isCombobox = target === containerRef.current;\n              const inListbox = target && listboxRef.current?.contains(target);\n              if (isCombobox || inListbox) {\n                event.preventDefault();\n              }\n            }}\n          >\n            <div className=\"absolute left-0 right-0 z-50 mt-1\">\n              <Command>\n                <CommandInput\n                  disabled={disabled}\n                  ref={inputRef}\n                  placeholder={placeholder}\n                  value={inputValue}\n                  onValueChange={setInputValue}\n                  onKeyDown={handleInputKeyDown}\n                  className=\"h-9\"\n                  autoFocus\n                />\n\n                <CommandEmpty>\n                  {!inputValue && \"No results found.\"}\n                </CommandEmpty>\n\n                <CommandGroup className=\"max-h-60 overflow-auto\">\n                  {options\n                    .filter((option) =>\n                      option.label\n                        .toLowerCase()\n                        .includes(inputValue.toLowerCase()),\n                    )\n                    .map((option) => {\n                      const isFullySelected = selected.includes(option.value);\n                      const isPartiallySelected = partiallySelected.includes(\n                        option.value,\n                      );\n\n                      return (\n                        <CommandItem\n                          key={option.value}\n                          onSelect={() => {\n                            // Toggle selection based on current state\n                            onChange(option.value, isFullySelected);\n                          }}\n                          className=\"flex items-center py-1.5 px-2 cursor-pointer\"\n                        >\n                          <div className=\"flex items-center w-full\">\n                            <div className=\"flex items-center mr-2\">\n                              <Checkbox\n                                checked={\n                                  isPartiallySelected\n                                    ? \"indeterminate\"\n                                    : isFullySelected\n                                }\n                              />\n                            </div>\n\n                            <span>{option.label}</span>\n                          </div>\n                        </CommandItem>\n                      );\n                    })}\n                </CommandGroup>\n\n                {inputValue && onCreateOption && !hasExactMatch && (\n                  <div className=\"mx-2\">\n                    <CommandSeparator />\n                    <Button\n                      disabled={disabled}\n                      type=\"button\"\n                      size=\"xs\"\n                      className=\"w-full my-2\"\n                      onClick={() => {\n                        onCreateOption(inputValue);\n                        setInputValue(\"\");\n                      }}\n                      variant=\"secondary\"\n                    >\n                      <span>Create tag: \"{inputValue}\"</span>\n                    </Button>\n                  </div>\n                )}\n              </Command>\n            </div>\n          </PopoverPrimitive.Content>\n        </PopoverPrimitive.Portal>\n      </div>\n    </PopoverPrimitive.Root>\n  );\n}\n",
      "type": "registry:ui",
      "target": ""
    }
  ],
  "type": "registry:ui"
}