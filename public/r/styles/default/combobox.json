{
  "$schema": "https://ui.blode.co/schema/registry-item.json",
  "name": "combobox",
  "title": "Combobox",
  "author": "Matthew Blode",
  "description": "An autocomplete input that combines a text field with a filterable dropdown list.",
  "dependencies": ["@base-ui/react"],
  "registryDependencies": ["button", "input-group", "popover"],
  "files": [
    {
      "path": "ui/combobox.tsx",
      "content": "\"use client\";\n\nimport { ChevronDownIcon } from \"blode-icons-react\";\nimport { type UseComboboxStateChange, useCombobox } from \"downshift\";\nimport {\n  forwardRef,\n  type ReactNode,\n  useCallback,\n  useImperativeHandle,\n  useRef,\n} from \"react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Input, type InputProps } from \"@/components/ui/input\";\nimport {\n  Popover,\n  PopoverAnchor,\n  PopoverContent,\n} from \"@/components/ui/popover\";\n\nexport interface ComboboxOption {\n  description?: string;\n  id?: string | number;\n  label?: string;\n}\n\nexport type OnChangeParams =\n  | ((changes: UseComboboxStateChange<ComboboxOption>) => void)\n  | undefined;\n\nexport interface ComboboxProps extends Omit<InputProps, \"value\" | \"onChange\"> {\n  children?: ReactNode;\n  clearable?: boolean;\n  clearInputValue?: () => void;\n  isLoading?: boolean;\n  leftIcon?: ReactNode;\n  noResults?: ReactNode;\n  onChange?: OnChangeParams;\n  onInputChange?: OnChangeParams;\n  options: ComboboxOption[] | undefined;\n  startOpen?: boolean;\n  value?: ComboboxOption | undefined;\n}\n\nexport interface ComboboxRef {\n  clearInput: () => void;\n  closeMenu: () => void;\n  focus: () => void;\n  inputValue: string;\n  selectItem: (option: ComboboxOption) => void;\n}\n\nexport const Combobox = forwardRef<ComboboxRef, ComboboxProps>(\n  (\n    {\n      options,\n      value,\n      onChange,\n      onInputChange,\n      startOpen = false,\n      onClear,\n      leftIcon,\n      clearable = false,\n      noResults,\n      children,\n      ...inputProps\n    },\n    ref\n  ) => {\n    const {\n      isOpen,\n      getInputProps,\n      getMenuProps,\n      highlightedIndex,\n      getItemProps,\n      selectItem,\n      inputValue,\n      setInputValue,\n      closeMenu,\n    } = useCombobox({\n      items: options || [],\n      itemToString: (item: ComboboxOption | null) => item?.label || \"\",\n      initialSelectedItem: value,\n      onInputValueChange: onInputChange,\n      onSelectedItemChange: onChange,\n      initialIsOpen: startOpen,\n      defaultHighlightedIndex: 0,\n    });\n\n    const comboboxRef = useRef<HTMLInputElement>(null);\n    const listboxRef = useRef<HTMLDivElement>(null);\n\n    const clearInput = useCallback(() => {\n      setInputValue(\"\");\n      onClear?.();\n    }, [onClear, setInputValue]);\n\n    useImperativeHandle(\n      ref,\n      () => ({\n        clearInput,\n        closeMenu,\n        selectItem,\n        inputValue,\n        focus: () => {\n          comboboxRef.current?.focus();\n        },\n      }),\n      [clearInput, closeMenu, inputValue, selectItem]\n    );\n\n    return (\n      <Popover defaultOpen={startOpen} open={isOpen}>\n        <PopoverAnchor asChild>\n          <Input\n            className={cn({\n              \"pl-10\": !!leftIcon,\n            })}\n            clearable={clearable}\n            leftControl={\n              <div className=\"absolute top-4 left-3\">{leftIcon}</div>\n            }\n            onClear={() => {\n              selectItem({});\n              onClear?.();\n            }}\n            ref={comboboxRef}\n            rightControl={\n              <div className=\"absolute top-4.5 right-3\">\n                {((clearable && inputValue.length === 0) || !clearable) && (\n                  <ChevronDownIcon className=\"size-4 opacity-50\" />\n                )}\n              </div>\n            }\n            {...getInputProps({}, { suppressRefError: true })}\n            {...inputProps}\n          />\n        </PopoverAnchor>\n\n        <PopoverContent\n          align=\"start\"\n          asChild\n          className=\"popover-content fade-in-80 relative z-110 max-h-[250px] w-(--anchor-width) max-w-(--available-width) translate-y-1 animate-in overflow-hidden rounded-xl border border-border bg-popover p-0 text-popover-foreground shadow-soft\"\n          onInteractOutside={(event) => {\n            const target = event.target as Element | null;\n            const isCombobox = target === comboboxRef.current;\n            const inListbox = target && listboxRef.current?.contains(target);\n\n            if (isCombobox || inListbox) {\n              event.preventDefault();\n            }\n          }}\n          onOpenAutoFocus={(event) => event.preventDefault()}\n          sideOffset={0}\n        >\n          <div\n            className=\"w-full overflow-y-auto p-1\"\n            ref={listboxRef}\n            {...getMenuProps({}, { suppressRefError: true })}\n          >\n            {children}\n\n            {(options || []).map((item, index) => {\n              const escapeRegExp = (string: string) => {\n                return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n              };\n\n              const labelParts = item.label?.split(\n                new RegExp(`(${escapeRegExp(inputValue)})`, \"gi\")\n              );\n\n              return (\n                <div\n                  className={cn(\n                    \"cursor-pointer touch-manipulation rounded-lg px-4 py-2\",\n                    {\n                      \"bg-accent text-accent-foreground\":\n                        highlightedIndex === index,\n                    }\n                  )}\n                  key={`${item.id}${index}`}\n                  style={{\n                    WebkitTapHighlightColor: \"transparent\",\n                    WebkitTouchCallout: \"none\",\n                  }}\n                  {...getItemProps({\n                    item,\n                    index,\n                  })}\n                >\n                  <div>\n                    {labelParts?.map((part, i) =>\n                      part.toLowerCase() === inputValue.toLowerCase() ? (\n                        <strong key={i}>{part}</strong>\n                      ) : (\n                        <span key={i}>{part}</span>\n                      )\n                    )}\n                  </div>\n\n                  {item.description && (\n                    <div className=\"text-muted-foreground text-sm\">\n                      {item.description}\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n\n            {(options || []).length === 0 &&\n              (noResults ? (\n                noResults\n              ) : (\n                <div className=\"cursor-not-allowed px-4 py-3 text-center\">\n                  <div className=\"text-muted-foreground\">No results</div>\n                </div>\n              ))}\n          </div>\n        </PopoverContent>\n      </Popover>\n    );\n  }\n);\n\nCombobox.displayName = \"Combobox\";\n",
      "type": "registry:ui",
      "target": ""
    }
  ],
  "type": "registry:ui"
}
