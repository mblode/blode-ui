{
  "$schema": "https://ui.fingertip.com/schema/registry-item.json",
  "name": "combobox",
  "author": "fingertip (https://ui.fingertip.com)",
  "dependencies": [
    "@fingertip/icons",
    "downshift",
    "@radix-ui/react-popover"
  ],
  "registryDependencies": [
    "input"
  ],
  "files": [
    {
      "path": "ui/combobox.tsx",
      "content": "\"use client\";\n\nimport { ChevronDownIcon } from \"@fingertip/icons\";\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\";\nimport { useCombobox, UseComboboxStateChange } from \"downshift\";\nimport React, {\n  forwardRef,\n  ReactNode,\n  useCallback,\n  useImperativeHandle,\n  useRef,\n} from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nimport { Input, InputProps } from \"./input\";\n\nexport type ComboboxOption = {\n  id?: string | number;\n  label?: string;\n  description?: string; // Added description field\n};\n\nexport type OnChangeParams =\n  | ((changes: UseComboboxStateChange<ComboboxOption>) => void)\n  | undefined;\n\nexport interface ComboboxProps extends Omit<InputProps, \"value\" | \"onChange\"> {\n  options: ComboboxOption[] | undefined;\n  value?: ComboboxOption | undefined;\n  onChange?: OnChangeParams;\n  onInputChange?: OnChangeParams;\n  isLoading?: boolean;\n  startOpen?: boolean;\n  leftIcon?: ReactNode;\n  clearable?: boolean;\n  children?: ReactNode;\n  noResults?: ReactNode;\n  clearInputValue?: () => void;\n  ref?: any;\n}\n\nexport type ComboboxRef = {\n  clearInput: () => void;\n  closeMenu: () => void;\n  selectItem: (option: ComboboxOption) => void;\n  inputValue: string;\n};\n\nexport const Combobox: React.FC<ComboboxProps> = forwardRef(\n  (\n    {\n      options,\n      value,\n      onChange,\n      onInputChange,\n      startOpen = false,\n      onClear,\n      leftIcon,\n      clearable = false,\n      noResults,\n      children,\n      ...inputProps\n    },\n    ref,\n  ) => {\n    const {\n      isOpen,\n      getInputProps,\n      getMenuProps,\n      highlightedIndex,\n      getItemProps,\n      selectItem,\n      inputValue,\n      setInputValue,\n      closeMenu,\n    } = useCombobox({\n      items: options || [],\n      itemToString: (item: ComboboxOption | null) => item?.label || \"\",\n      initialSelectedItem: value,\n      onInputValueChange: onInputChange,\n      onSelectedItemChange: onChange,\n      initialIsOpen: startOpen,\n      defaultHighlightedIndex: 0,\n    });\n\n    const comboboxRef = useRef<HTMLInputElement>(null);\n    const listboxRef = useRef<HTMLDivElement>(null);\n\n    const clearInput = useCallback(() => {\n      setInputValue(\"\");\n      if (onClear) {\n        onClear();\n      }\n    }, [onClear, setInputValue]);\n\n    useImperativeHandle(\n      ref,\n      () =>\n        ({\n          clearInput,\n          closeMenu,\n          selectItem,\n          inputValue,\n          focus: () => {\n            if (comboboxRef.current) {\n              comboboxRef.current.focus();\n            }\n          },\n        }) as ComboboxRef,\n      [clearInput, closeMenu, inputValue, selectItem],\n    );\n\n    return (\n      <>\n        <PopoverPrimitive.Root defaultOpen={startOpen} open={isOpen}>\n          <PopoverPrimitive.Anchor asChild>\n            <div className=\"relative w-full\">\n              <Input\n                className={cn({\n                  \"pl-10\": !!leftIcon,\n                })}\n                onClear={() => {\n                  selectItem({});\n                  onClear?.();\n                }}\n                clearable={clearable}\n                {...getInputProps({}, { suppressRefError: true })}\n                {...inputProps}\n                ref={comboboxRef}\n              />\n              <div className=\"absolute right-3 top-4.5\">\n                {((clearable && inputValue.length === 0) || !clearable) && (\n                  <ChevronDownIcon className=\"size-4 opacity-50\" />\n                )}\n              </div>\n\n              <div className=\"absolute left-3 top-4\">{leftIcon}</div>\n            </div>\n          </PopoverPrimitive.Anchor>\n\n          <PopoverPrimitive.Portal>\n            <PopoverPrimitive.Content\n              align=\"start\"\n              className=\"popover-content relative z-110 max-h-[250px] min-w-32 translate-y-1 overflow-hidden rounded-xl border border-border bg-popover text-popover-foreground shadow-soft animate-in fade-in-80\"\n              asChild\n              onOpenAutoFocus={(event) => event.preventDefault()}\n              onInteractOutside={(event) => {\n                const target = event.target as Element | null;\n                const isCombobox = target === comboboxRef.current;\n                const inListbox =\n                  target && listboxRef.current?.contains(target);\n                if (isCombobox || inListbox) {\n                  event.preventDefault();\n                }\n              }}\n            >\n              <div\n                className=\"w-full overflow-y-auto p-1\"\n                {...getMenuProps({}, { suppressRefError: true })}\n              >\n                {children}\n\n                {(options || []).map((item, index) => {\n                  const escapeRegExp = (string: string) => {\n                    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n                  };\n\n                  const labelParts = item.label?.split(\n                    new RegExp(`(${escapeRegExp(inputValue)})`, \"gi\"),\n                  );\n\n                  return (\n                    <div\n                      key={`${item.id}${index}`}\n                      className={cn(\"rounded-lg cursor-pointer px-4 py-2\", {\n                        \"bg-accent text-accent-foreground\":\n                          highlightedIndex === index,\n                      })}\n                      {...getItemProps({\n                        item,\n                        index,\n                      })}\n                    >\n                      <div>\n                        {labelParts?.map((part, i) =>\n                          part.toLowerCase() === inputValue.toLowerCase() ? (\n                            <strong key={i}>{part}</strong>\n                          ) : (\n                            <span key={i}>{part}</span>\n                          ),\n                        )}\n                      </div>\n                      {item.description && (\n                        <div className=\"text-sm text-muted-foreground\">\n                          {item.description}\n                        </div>\n                      )}\n                    </div>\n                  );\n                })}\n\n                {(options || []).length === 0 &&\n                  (noResults ? (\n                    noResults\n                  ) : (\n                    <div className=\"cursor-not-allowed px-4 py-3 text-center\">\n                      <div className=\"text-muted-foreground\">No results</div>\n                    </div>\n                  ))}\n              </div>\n            </PopoverPrimitive.Content>\n          </PopoverPrimitive.Portal>\n        </PopoverPrimitive.Root>\n      </>\n    );\n  },\n);\n",
      "type": "registry:ui",
      "target": ""
    }
  ],
  "type": "registry:ui"
}