{
  "$schema": "https://ui.blode.co/schema/registry-item.json",
  "name": "popover",
  "title": "Popover",
  "author": "Matthew Blode",
  "description": "A floating panel that appears next to a trigger element.",
  "dependencies": ["@base-ui/react"],
  "files": [
    {
      "path": "ui/popover.tsx",
      "content": "\"use client\";\n\nimport { Popover as PopoverPrimitive } from \"@base-ui/react/popover\";\nimport * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\ntype PopoverInteractOutsideEvent = Event & {\n  preventDefault: () => void;\n};\n\ninterface PopoverContextType {\n  anchor: HTMLElement | null;\n  setAnchor: (anchor: HTMLElement | null) => void;\n  setOnInteractOutside: (\n    handler?: (event: PopoverInteractOutsideEvent) => void\n  ) => void;\n}\n\nconst PopoverContext = React.createContext<PopoverContextType | undefined>(\n  undefined\n);\n\nconst usePopoverContext = () => React.useContext(PopoverContext);\n\nfunction setRef<T>(ref: React.Ref<T> | undefined, value: T) {\n  if (typeof ref === \"function\") {\n    ref(value);\n    return;\n  }\n\n  if (ref && \"current\" in ref) {\n    ref.current = value;\n  }\n}\n\nfunction Popover({\n  onOpenChange,\n  ...props\n}: React.ComponentProps<typeof PopoverPrimitive.Root>) {\n  const [anchor, setAnchor] = React.useState<HTMLElement | null>(null);\n  const onInteractOutsideRef = React.useRef<\n    ((event: PopoverInteractOutsideEvent) => void) | undefined\n  >(undefined);\n\n  const handleOpenChange = React.useCallback<\n    NonNullable<\n      React.ComponentProps<typeof PopoverPrimitive.Root>[\"onOpenChange\"]\n    >\n  >(\n    (open, eventDetails) => {\n      if (!open && eventDetails.reason === \"outside-press\") {\n        const interactHandler = onInteractOutsideRef.current;\n\n        if (interactHandler) {\n          const wrappedEvent = Object.create(\n            eventDetails.event\n          ) as PopoverInteractOutsideEvent;\n          wrappedEvent.preventDefault = () => eventDetails.cancel();\n          interactHandler(wrappedEvent);\n        }\n      }\n\n      onOpenChange?.(open, eventDetails);\n    },\n    [onOpenChange]\n  );\n\n  return (\n    <PopoverContext.Provider\n      value={{\n        anchor,\n        setAnchor,\n        setOnInteractOutside: (handler) => {\n          onInteractOutsideRef.current = handler;\n        },\n      }}\n    >\n      <PopoverPrimitive.Root\n        data-slot=\"popover\"\n        onOpenChange={handleOpenChange}\n        {...props}\n      />\n    </PopoverContext.Provider>\n  );\n}\n\nfunction PopoverTrigger({\n  asChild = false,\n  children,\n  ...props\n}: React.ComponentProps<typeof PopoverPrimitive.Trigger> & {\n  asChild?: boolean;\n}) {\n  const render =\n    asChild && React.isValidElement(children)\n      ? (children as React.ReactElement)\n      : undefined;\n\n  return (\n    <PopoverPrimitive.Trigger\n      data-slot=\"popover-trigger\"\n      render={render}\n      {...props}\n    >\n      {asChild ? null : children}\n    </PopoverPrimitive.Trigger>\n  );\n}\n\ntype PopoverContentProps = React.ComponentProps<typeof PopoverPrimitive.Popup> &\n  Pick<\n    React.ComponentProps<typeof PopoverPrimitive.Positioner>,\n    \"align\" | \"alignOffset\" | \"side\" | \"sideOffset\"\n  > & {\n    asChild?: boolean;\n    onInteractOutside?: (event: PopoverInteractOutsideEvent) => void;\n    onOpenAutoFocus?: (event: Event) => void;\n  };\n\nfunction PopoverContent({\n  asChild = false,\n  children,\n  className,\n  align = \"center\",\n  alignOffset = 0,\n  side = \"bottom\",\n  sideOffset = 4,\n  initialFocus,\n  onInteractOutside,\n  onOpenAutoFocus,\n  ...props\n}: PopoverContentProps) {\n  const popoverContext = usePopoverContext();\n\n  React.useEffect(() => {\n    popoverContext?.setOnInteractOutside(onInteractOutside);\n\n    return () => {\n      popoverContext?.setOnInteractOutside(undefined);\n    };\n  }, [onInteractOutside, popoverContext]);\n\n  React.useEffect(() => {\n    if (!onOpenAutoFocus) {\n      return;\n    }\n\n    const event = new Event(\"openAutoFocus\", { cancelable: true });\n    onOpenAutoFocus(event);\n  }, [onOpenAutoFocus]);\n\n  const render =\n    asChild && React.isValidElement(children)\n      ? (children as React.ReactElement)\n      : undefined;\n\n  return (\n    <PopoverPrimitive.Portal>\n      <PopoverPrimitive.Positioner\n        align={align}\n        alignOffset={alignOffset}\n        anchor={popoverContext?.anchor}\n        className=\"isolate z-50\"\n        side={side}\n        sideOffset={sideOffset}\n      >\n        <PopoverPrimitive.Popup\n          className={cn(\n            \"data-closed:fade-out-0 data-open:fade-in-0 data-closed:zoom-out-95 data-open:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--transform-origin) rounded-md border bg-popover p-4 text-popover-foreground shadow-soft outline-hidden data-closed:animate-out data-open:animate-in\",\n            className\n          )}\n          data-slot=\"popover-content\"\n          initialFocus={onOpenAutoFocus ? false : initialFocus}\n          render={render}\n          {...props}\n        >\n          {asChild ? null : children}\n        </PopoverPrimitive.Popup>\n      </PopoverPrimitive.Positioner>\n    </PopoverPrimitive.Portal>\n  );\n}\n\nfunction PopoverAnchor({\n  asChild = false,\n  children,\n  ref,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean;\n}) {\n  const popoverContext = usePopoverContext();\n\n  const handleRef = React.useCallback(\n    (node: HTMLElement | null) => {\n      popoverContext?.setAnchor(node);\n      setRef(ref as React.Ref<HTMLElement> | undefined, node);\n    },\n    [popoverContext, ref]\n  );\n\n  if (asChild && React.isValidElement(children)) {\n    const child = children as React.ReactElement<{\n      ref?: React.Ref<HTMLElement>;\n      [key: string]: unknown;\n    }>;\n\n    return React.cloneElement(child, {\n      ...props,\n      ref: (node: HTMLElement | null) => {\n        setRef(child.props.ref, node);\n        handleRef(node);\n      },\n    });\n  }\n\n  return (\n    <div data-slot=\"popover-anchor\" ref={handleRef} {...props}>\n      {children}\n    </div>\n  );\n}\n\nfunction PopoverHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      className={cn(\"flex flex-col gap-1 text-sm\", className)}\n      data-slot=\"popover-header\"\n      {...props}\n    />\n  );\n}\n\nfunction PopoverTitle({ className, ...props }: React.ComponentProps<\"h2\">) {\n  return (\n    <div\n      className={cn(\"font-medium\", className)}\n      data-slot=\"popover-title\"\n      {...props}\n    />\n  );\n}\n\nfunction PopoverDescription({\n  className,\n  ...props\n}: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      className={cn(\"text-muted-foreground\", className)}\n      data-slot=\"popover-description\"\n      {...props}\n    />\n  );\n}\n\nexport {\n  Popover,\n  PopoverTrigger,\n  PopoverContent,\n  PopoverAnchor,\n  PopoverHeader,\n  PopoverTitle,\n  PopoverDescription,\n};\n",
      "type": "registry:ui",
      "target": ""
    }
  ],
  "type": "registry:ui"
}
